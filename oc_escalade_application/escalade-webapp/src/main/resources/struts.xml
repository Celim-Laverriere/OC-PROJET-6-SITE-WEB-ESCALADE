<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
        "http://struts.apache.org/dtds/struts-2.5.dtd">

<struts>

    <!-- ============================================ -->
    <!-- ===== Package de configuration de base ===== -->
    <!-- ============================================ -->
    <package name="base" abstract="true" extends="struts-default">
        <interceptors>
            <interceptor name="auth" class="org.escalade.webapp.interceptor.AuthInterceptor"/>

            <interceptor-stack name="authenticatedStack">
                <interceptor-ref name="auth"/>
                <interceptor-ref name="defaultStack"/>
            </interceptor-stack>
        </interceptors>

        <global-results>
            <result name="error">/jsp/error.jsp</result>
            <result name="error-forbidden" type="httpheader">
                <param name="error">403</param>
            </result>
        </global-results>
    </package>

    <!-- ============================================== -->
    <!-- ===== Package pour les actions publiques ===== -->
    <!-- ============================================== -->
    <package name="public" extends="base">
        <!-- Action par défaut -->
        <default-action-ref name="index"/>

        <!-- Action "index" -->
        <action name="index">
            <result name="success">/jsp/index.jsp</result>
        </action>

        <!-- ===== Actions Login/Logout ===== -->
        <action name="login"
                class="org.escalade.webapp.action.LoginAction"
                method="doLogin">
            <result name="input">/jsp/login/login.jsp</result>
            <result name="success">jsp/_include/formulaireChoixCreate.jsp</result>
        </action>

        <action name="logout"
                class="org.escalade.webapp.action.LoginAction"
                method="doLogout">
            <result type="redirectAction">/jsp/index.jsp</result>
        </action>

        <!-- ==== Action pour lister les sites ==== -->
        <action name="site_list"
                class="org.escalade.webapp.action.SiteAction"
                method="doList">
            <result>/jsp/site/list.jsp</result>
        </action>

        <action name="site_detail"
                class="org.escalade.webapp.action.SiteAction"
                method="doDetail">
            <result name="success">/jsp/site/detail.jsp</result>
            <result name="error">/jsp/error.jsp</result>
        </action>

        <action name="voie_detail"
                class="org.escalade.webapp.action.VoieAction"
                method="doDetail">
            <result name="success">/jsp/voie/detail.jsp</result>
            <result name="error">/jsp/error.jsp</result>
        </action>

        <action name="topo_list"
                class="org.escalade.webapp.action.TopoAction"
                method="doList">
            <result name="success">/jsp/topo/list.jsp</result>
            <result name="error">/jsp/error.jsp</result>
        </action>

        <action name="topo_detail"
                class="org.escalade.webapp.action.TopoAction"
                method="doDetail">
            <result name="success">/jsp/topo/detail.jsp</result>
            <result name="error">/jsp/error.jsp</result>
        </action>

        <!-- ================================ -->
        <!-- =====      RECHERCHE       ===== -->
        <!-- ================================ -->

        <!-- ===== Action permettant de faire une recherche via la Barre de recherche ===== -->
        <action name="barre_de_recherche"
                class="org.escalade.webapp.action.MoteurDeRechercheAction"
                method="doSimpleSearch">

            <interceptor-ref name="store">
                <param name="operationMode">STORE</param>
            </interceptor-ref>
            <interceptor-ref name="defaultStack"/>

            <result name="success">/jsp/moteur_de_recherche/resultat_recherche.jsp</result>
            <result name="error">/jsp/error.jsp</result>
        </action>

        <!-- ===== Action permettant de faire une recherche avancé ===== -->
        <action name="recherche_avancer"
                class="org.escalade.webapp.action.MoteurDeRechercheAction"
                method="doAdvancedSearch">

            <interceptor-ref name="store">
                <param name="operationMode">STORE</param>
            </interceptor-ref>
            <interceptor-ref name="defaultStack"/>

            <result name="input">/jsp/moteur_de_recherche/formulaire_de_recherche_avance.jsp</result>
            <result name="success">/jsp/moteur_de_recherche/resultat_recherche.jsp</result>
        </action>

        <!-- Création de compte utilisateur -->
        <action name="creerCompte"
                class="org.escalade.webapp.action.CompteAction"
                method="doCreate">

            <interceptor-ref name="store">
                <param name="operationMode">STORE</param>
            </interceptor-ref>
            <interceptor-ref name="defaultStack"/>

            <result name="input">jsp/formulaire_de_creation/formulaire_compte.jsp</result>
            <result name="success">jsp/login/login.jsp</result>
            <result name="error">/jsp/compte/formulaire_secteur.jsp</result>
        </action>

    </package>

    <!-- ============================================ -->
    <!-- ===== Package pour les actions privées ===== -->
    <!-- ============================================ -->
    <package name="private" extends="base">
        <default-interceptor-ref name="authenticatedStack"/>

        <!-- ================================================== -->
        <!-- =====  Renvoie les choix des formulaires     ===== -->
        <!-- =====  de création des sites d'escalade      ===== -->
        <!-- ================================================== -->

        <action name="choixCreate">

            <interceptor-ref name="store">
                <param name="operationMode">RETRIEVE</param>
            </interceptor-ref>
            <interceptor-ref name="authenticatedStack"/>

            <result name="success">/jsp/_include/formulaireChoixCreate.jsp</result>
            <result name="error">/jsp/error.jsp</result>
        </action>

        <!-- Récupère les informations pour créer un nouveau site -->
        <action name="new_site"
                class="org.escalade.webapp.action.SiteAction"
                method="doCreate">

            <interceptor-ref name="store">
                <param name="operationMode">STORE</param>
            </interceptor-ref>
            <interceptor-ref name="authenticatedStack"/>

            <result name="input">jsp/formulaire_de_creation/formulaire_site.jsp</result>
            <result name="success" type="redirectAction">/jsp/_include/formulaireChoixCreate.jsp</result>
            <result name="error">/jsp/compte/formulaire_site.jsp</result>
        </action>

        <!-- Récupère les informations pour créer un nouveau secteur -->

        <action name="new_secteur"
                class="org.escalade.webapp.action.SecteurAction"
                method="doCreate">

            <interceptor-ref name="store">
                <param name="operationMode">STORE</param>
            </interceptor-ref>
            <interceptor-ref name="authenticatedStack"/>

            <result name="input">jsp/formulaire_de_creation/formulaire_secteur.jsp</result>
            <result name="success" type="redirectAction">/jsp/_include/formulaireChoixCreate.jsp</result>
            <result name="error">/jsp/compte/formulaire_secteur.jsp</result>
        </action>
        
        <action name="modifier_compte_utilisateur"
                class="org.escalade.webapp.action.CompteAction"
                method="upCompte">

            <interceptor-ref name="store">
                <param name="operationMode">STORE</param>
            </interceptor-ref>
            <interceptor-ref name="authenticatedStack"/>
            <interceptor-ref name="defaultStack"/>

            <result name="input">jsp/formulaire_de_creation/formulaire_compte.jsp</result>
            <result name="success">jsp/_include/formulaireChoixCreate.jsp</result>
            <result name="error">/jsp/compte/formulaire_secteur.jsp</result>
        </action>

    </package>
</struts>